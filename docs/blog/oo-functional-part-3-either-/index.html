<html><head><link href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.1.0/css/bulma.min.css" rel="stylesheet"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/monokai-sublime.min.css"/><link href="http://fonts.googleapis.com/css?family=Playfair+Display|Amiri" rel="stylesheet" type="text/css"/><link href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet"/><link rel="stylesheet" href="/app.css"/><title>OO + Functional - Part 3 - Either || | Journey Through Cyberspace &amp; Realtime</title><meta property="og:title" content="OO + Functional - Part 3 - Either ||"/><meta property="twitter:title" content="OO + Functional - Part 3 - Either ||"/><meta property="og:type" content="article"/><meta property="og:url" content="https://i.am.benjaminclos.com/blog/oo-functional-part-3-either-"/><meta property="twitter:card" content="summary"/><meta property="twitter:site" content="benjaminclos"/><meta property="og:description" content="The third in a series of musings on pairing OOP with functional paradigms; recovering from empty values with the Either monad."/><meta property="twitter:description" content="The third in a series of musings on pairing OOP with functional paradigms; recovering from empty values with the Either monad."/><meta property="og:published_time" content="2016-08-21T04:00:00.000Z"/><meta property="og:tags" content="[object Object], [object Object], [object Object], [object Object]"/><style>.hljs-comment {
  color: #5B8B05;
}
</style></head><body class="blog"><div class="_app_y0853_3804 "><div class="_top_y0853_3838 _navigation_y0853_3838 _detached_y0853_3855 "><div class="_container_y0853_242 "><div class="_nav_y0853_1722 "><div class="_nav-center_y0853_2997 "><a class="_nav-item_y0853_2925 " href="/">home</a><a class="_nav-item_y0853_2925 " href="/blog">blog</a><a class="_nav-item_y0853_2925 " href="/blog/tags">tags</a></div></div></div></div><div class="_main_y0853_3810 "><div class="_container_y0853_242 "> <div class="_columns_y0853_1930 "><div class="_column_y0853_1925 _is-8_y0853_1995 _is-offset-2_y0853_1968 "><article class="_container_y0853_242 "><header><h1 class="_title_1bjig_21 ">OO + Functional - Part 3 - Either ||</h1><h3>8.21.2016</h3><h3></h3><h3 class="_tag-list_1bjig_14 "><a href="/blog/tags/javascript">javascript</a><a href="/blog/tags/functional">functional</a><a href="/blog/tags/oop">oop</a><a href="/blog/tags/series-monads">series:monads</a></h3></header><div class="_content_1bjig_37 _block_y0853_238 "><p>In the <a href="/blog/oo-functional-part-2-call-me-maybe/">last segment</a> we extended our <code>Monad</code> to create <code>Maybe</code> which allowed us to shortcircuit <code>Nothing</code> operations.  Today we are going to continue with this extending our logical branching by creating the <code>Either</code> monad.  The <code>Either</code> allows us to recover or transition (<code>fmap</code>) from <code>Nothing</code> to our default value.</p>
<p>Let's work on our <code>Either</code> implementation:</p>
<pre><code class="hljs">
<span class="hljs-keyword">const</span>
  Maybe = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./Maybe"</span>)

<span class="hljs-built_in">module</span>.exports = <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Either</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Maybe</span> </span>{
  <span class="hljs-comment">// explicit Either creation for flat `fmap`</span>
  <span class="hljs-keyword">static</span> Either (val) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Either(val)
  }
  <span class="hljs-comment">// curried Either creation</span>
  <span class="hljs-keyword">static</span> or (fallback) {
    <span class="hljs-keyword">return</span> val =&gt; Either.of(val).or(fallback)
  }
  <span class="hljs-comment">// so we can chain our fallback value</span>
  or (fallback) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.of( <span class="hljs-keyword">this</span>.isNothing ? fallback : <span class="hljs-keyword">this</span> )
  }
}
</code></pre>
<p>Well that was not very much code, but it will be yet another powerful building block. We have also introduced a new concept with the static <code>or</code> method, where we are <a href="https://en.wikipedia.org/wiki/Partial_application">partially applying</a> the creation of our <code>Either</code> with a higher-order function.</p>
<p><strong><em>Higher-order Functions:</em></strong>
<em>Functions that both accept functions as arguments and return functions as results.</em></p>
<p><strong><em>Partial Application:</em></strong>
<em>Translating a function that is executed with a set of arguments and into a series of functions each accepting one or more of the arguments until the set is full, where the function then executes with the completed set of arguments.</em></p>
<p><strong><em>Currying:</em></strong>
<em>Translating a function that is executed with a set of arguments into a series of <strong><em>unary</em></strong> functions, or functions that only accept 1 argument.</em></p>
<p>Because we know that our Either branch is a binary logic chain, that is to say it can only have 2 possible branches (value or fallback), we only need a naive partial application approach.</p>
<p>This allows us to return a partially applied <code>Either</code> that has a pre-determined fallback logic branch.  How about we use this in an example:</p>
<pre><code class="hljs"><span class="hljs-keyword">const</span>
    <span class="hljs-built_in">Promise</span>     = <span class="hljs-built_in">require</span>(<span class="hljs-string">"bluebird"</span>)
  , Either      = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../monads/Either"</span>)
  , fred        = { name : <span class="hljs-string">"fred"</span> }
  , george      = { name : <span class="hljs-string">"george"</span> }
  <span class="hljs-comment">// our partially applied Either function</span>
  , orAnonymous = Either.or({ name : <span class="hljs-string">"anonymous"</span> })

<span class="hljs-built_in">console</span>.log(Either.of(<span class="hljs-literal">undefined</span>).or(fred)) 
<span class="hljs-comment">// Either&lt;{ name: 'fred' }&gt;</span>

<span class="hljs-built_in">console</span>.log(Either.of(george).or(fred)) 
<span class="hljs-comment">// Either&lt;{ name: 'george' }&gt;</span>

<span class="hljs-comment">// mock looking up an array of connections</span>
<span class="hljs-comment">// where people may or may not be authenticated with the service.</span>
<span class="hljs-keyword">const</span> getActiveUsers = _ =&gt; <span class="hljs-built_in">Promise</span>.resolve([ 
    fred
  , george
  , <span class="hljs-literal">null</span>
  , <span class="hljs-literal">undefined</span> 
])

getActiveUsers().map(orAnonymous).then(<span class="hljs-built_in">console</span>.log)
<span class="hljs-comment">/*
[ { name: 'fred' },
  { name: 'george' },
  { name: 'anonymous' },
  { name: 'anonymous' } ]

*/</span>

</code></pre>
<p>Well that is nice, but let's make the interface a little more intuitive with some OOP to extend our <code>Either</code> into a <code>User</code> that can either be logged in or anonymous.</p>
<pre><code class="hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Either</span> </span>{
  <span class="hljs-comment">// pure creation interface!</span>
  <span class="hljs-comment">// always expose something that </span>
  <span class="hljs-comment">// plays nicely with Array.prototype</span>
  <span class="hljs-keyword">static</span> User (user) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> User(user).or()
  }

  <span class="hljs-keyword">static</span> get anonymous () {
    <span class="hljs-keyword">return</span> { name : <span class="hljs-string">`anonymous-<span class="hljs-subst">${User.UUID++}</span>`</span> }
  }

  or () {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.of( <span class="hljs-keyword">this</span>.isEmpty ? User.anonymous : <span class="hljs-keyword">this</span> )
  }

}
<span class="hljs-comment">// I cannot wait for ES6 static properties to hit Node.js</span>
User.UUID = <span class="hljs-number">0</span>
</code></pre>
<p>That did not require too much work, but added a lot of expressiveness to our API with minimal overhead.  All we really had to do was come up with a generic way to name our anonymous users and override our default <code>Either.prototype.or</code> behavior.</p>
<p>Now let's see it in action:</p>
<pre><code class="hljs"><span class="hljs-keyword">import</span> {User} <span class="hljs-keyword">from</span> <span class="hljs-string">"../monads/User"</span>

<span class="hljs-built_in">console</span>.log(User(<span class="hljs-literal">null</span>))
<span class="hljs-comment">// User&lt;{ name: 'anonymous-0' }&gt;</span>
<span class="hljs-built_in">console</span>.log(User(fred))
<span class="hljs-comment">// User&lt;{ name: 'fred' }&gt;</span>
getActiveUsers().map(User).then(<span class="hljs-built_in">console</span>.log)
<span class="hljs-comment">/*
[ { name: 'fred' },
  { name: 'george' },
  { name: 'anonymous-1' },
  { name: 'anonymous-2' } ]
*/</span>
</code></pre>
<p>As you may have noticed it is still a little awkward to handle deeply nested properties with our current toolset.  Performing an <code>fmap</code> on <code>fred.address.streetname</code> would still cause us to throw unless we were sure that the property existed.</p>
<p>In the next post, we will illustrate how to compose our <code>Maybe</code> and <code>Either</code> to create a Javascript relevant version of a <a href="https://www21.in.tum.de/teaching/fp/SS15/papers/17.pdf"><code>Lens</code></a> to safely get and set arbitrarily deep properies on an <code>Object</code>.</p>
</div></article><section class="section comments"><div class="content"><div id="disqus_thread"><script>(function() {  // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//benjaminclos.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div></section></div></div></div></div><div class="_navigation_y0853_3838 _bottom_y0853_3906 "><div class="_container_y0853_242 "><div class="_nav_y0853_1722 "><div class="_nav-center_y0853_2997 "><a class="_nav-item_y0853_2925 " href="https://github.com/ondreian"><i class="ion-social-github"></i></a><a class="_nav-item_y0853_2925 " href="https://twitter.com/benjaminclos"><i class="ion-social-twitter"></i></a></div></div></div></div></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-82549801-1', 'auto');
ga('send', 'pageview');</script></body></html>